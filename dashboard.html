<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€ì‹œë³´ë“œ - VIBE EDiT</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #0f0f0f;
            color: #ffffff;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
        }
        
        /* Header */
        .dashboard-header {
            height: 64px;
            background: #1a1a1a;
            border-bottom: 1px solid #2a2a2a;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: #8B5CF6;
            text-decoration: none;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .create-btn {
            padding: 10px 20px;
            background: #8B5CF6;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }
        
        .create-btn:hover {
            background: #7C3AED;
        }
        
        .user-menu {
            position: relative;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #8B5CF6;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .user-avatar:hover {
            background: #7C3AED;
        }
        
        .user-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            min-width: 200px;
            display: none;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .user-dropdown.show {
            display: block;
        }
        
        .dropdown-item {
            padding: 12px 16px;
            color: #ccc;
            text-decoration: none;
            display: block;
            transition: all 0.2s;
            border-bottom: 1px solid #2a2a2a;
        }
        
        .dropdown-item:last-child {
            border-bottom: none;
        }
        
        .dropdown-item:hover {
            background: #252525;
            color: white;
        }
        
        .dropdown-item.danger {
            color: #EF4444;
        }
        
        .dropdown-item.danger:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        /* Main Content */
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 24px;
        }
        
        .dashboard-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 32px;
            border-bottom: 1px solid #2a2a2a;
        }
        
        .tab-btn {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: #666;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            position: relative;
            top: 1px;
        }
        
        .tab-btn:hover {
            color: #ccc;
        }
        
        .tab-btn.active {
            color: white;
            border-bottom-color: #8B5CF6;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Projects Grid */
        .projects-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .projects-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
        }
        
        .project-card {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .project-card:hover {
            border-color: #8B5CF6;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(139, 92, 246, 0.2);
        }
        
        .project-thumbnail {
            width: 100%;
            aspect-ratio: 4/3;
            background: #252525;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .project-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .project-thumbnail-placeholder {
            font-size: 3rem;
            color: #444;
        }
        
        .project-info {
            padding: 16px;
        }
        
        .project-title {
            font-size: 1rem;
            font-weight: 600;
            color: white;
            margin-bottom: 8px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .project-meta {
            font-size: 0.85rem;
            color: #666;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .project-actions {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .project-card:hover .project-actions {
            opacity: 1;
        }
        
        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: none;
            background: rgba(26, 26, 26, 0.9);
            color: #ccc;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background: #252525;
            color: white;
        }
        
        .action-btn.danger:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #EF4444;
        }
        
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #666;
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 16px;
        }
        
        .empty-state h3 {
            font-size: 1.25rem;
            margin-bottom: 8px;
            color: #ccc;
        }
        
        .empty-state p {
            font-size: 0.95rem;
            margin-bottom: 24px;
        }
        
        /* Account Settings */
        .settings-section {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .settings-section h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: white;
        }
        
        .settings-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-label {
            font-size: 0.85rem;
            color: #666;
            font-weight: 500;
        }
        
        .form-input {
            padding: 12px 16px;
            background: #252525;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            color: white;
            font-size: 0.95rem;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #8B5CF6;
        }
        
        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 8px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #8B5CF6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #7C3AED;
        }
        
        .btn-secondary {
            background: #252525;
            color: #ccc;
            border: 1px solid #3a3a3a;
        }
        
        .btn-secondary:hover {
            background: #2a2a2a;
            color: white;
        }
        
        .btn-danger {
            background: transparent;
            color: #EF4444;
            border: 1px solid #EF4444;
        }
        
        .btn-danger:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        .danger-zone {
            border-top: 1px solid #2a2a2a;
            padding-top: 24px;
            margin-top: 24px;
        }
        
        .danger-zone h3 {
            color: #EF4444;
        }
        
        .danger-zone p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="dashboard-header">
        <a href="dashboard.html" class="logo">VIBE EDiT</a>
        <div class="header-actions">
            <a href="editor.html" class="create-btn">+ ìƒˆ ë””ìì¸ ë§Œë“¤ê¸°</a>
            <div class="user-menu">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-dropdown" id="userDropdown">
                    <a href="#account" class="dropdown-item" data-tab="account">ê³„ì • ì„¤ì •</a>
                    <a href="#" class="dropdown-item" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</a>
                    <a href="delete.html" class="dropdown-item danger">ê³„ì • ì‚­ì œ</a>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <div class="dashboard-container">
        <!-- Tabs -->
        <div class="dashboard-tabs">
            <button class="tab-btn active" data-tab="projects">ë‚´ ë””ìì¸</button>
            <button class="tab-btn" data-tab="account">ê³„ì • ì„¤ì •</button>
        </div>
        
        <!-- Projects Tab -->
        <div class="tab-content active" id="projectsTab">
            <div class="projects-header">
                <h2>ë‚´ ë””ìì¸</h2>
            </div>
            <div class="projects-grid" id="projectsGrid">
                <!-- Projects will be loaded here -->
            </div>
        </div>
        
        <!-- Account Tab -->
        <div class="tab-content" id="accountTab">
            <div class="settings-section">
                <h3>í”„ë¡œí•„ ì •ë³´</h3>
                <form class="settings-form" id="profileForm">
                    <div class="form-group">
                        <label class="form-label">ì´ë¦„</label>
                        <input type="text" class="form-input" id="userName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì•„ì´ë””</label>
                        <input type="text" class="form-input" id="userEmail" placeholder="ì•„ì´ë””" readonly>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">ë³€ê²½ì‚¬í•­ ì €ì¥</button>
                    </div>
                </form>
            </div>
            
            <div class="settings-section danger-zone">
                <h3>ê³„ì • ì‚­ì œ</h3>
                <p>ê³„ì •ì„ ì‚­ì œí•˜ë©´ ëª¨ë“  ë””ìì¸ê³¼ ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë˜ë©° ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                <button class="btn btn-danger" id="deleteAccountBtn">ê³„ì • ì‚­ì œ</button>
            </div>
        </div>
    </div>
    
    <script src="js/main.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // Tab switching
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const targetTab = btn.getAttribute('data-tab');
                
                // Update buttons
                tabButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // Update contents
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === `${targetTab}Tab`) {
                        content.classList.add('active');
                    }
                });
            });
        });
        
        // User dropdown
        const userAvatar = document.getElementById('userAvatar');
        const userDropdown = document.getElementById('userDropdown');
        
        if (userAvatar && userDropdown) {
            userAvatar.addEventListener('click', (e) => {
                e.stopPropagation();
                userDropdown.classList.toggle('show');
            });
            
            document.addEventListener('click', () => {
                userDropdown.classList.remove('show');
            });
            
            userDropdown.addEventListener('click', (e) => {
                e.stopPropagation();
            });
        }
        
        // Load user projects from D1 database
        async function loadProjects() {
            const projectsGrid = document.getElementById('projectsGrid');
            if (!projectsGrid) return;
            
            // Get current user
            const currentUser = JSON.parse(localStorage.getItem('vibe_user') || 'null');
            if (!currentUser || !currentUser.id) {
                projectsGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-state-icon">ğŸ”’</div>
                        <h3>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h3>
                        <p>í”„ë¡œì íŠ¸ë¥¼ ë³´ë ¤ë©´ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”</p>
                        <a href="login.html" class="create-btn">ë¡œê·¸ì¸</a>
                    </div>
                `;
                return;
            }
            
            try {
                // Load projects from API
                const response = await fetch(`/api/projects?user_id=${encodeURIComponent(currentUser.id)}`);
                const result = await response.json();
                
                if (!result.success || !result.projects || result.projects.length === 0) {
                    projectsGrid.innerHTML = `
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <div class="empty-state-icon">ğŸ¨</div>
                            <h3>ì•„ì§ ë””ìì¸ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                            <p>ìƒˆ ë””ìì¸ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”</p>
                            <a href="editor.html" class="create-btn">+ ìƒˆ ë””ìì¸ ë§Œë“¤ê¸°</a>
                        </div>
                    `;
                    return;
                }
                
                const projects = result.projects;
                
                projectsGrid.innerHTML = projects.map(project => {
                    const date = new Date(project.updated_at || project.created_at || Date.now());
                    const dateStr = date.toLocaleDateString('ko-KR', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    });
                    
                    return `
                        <div class="project-card" data-id="${project.id}">
                            <div class="project-actions">
                                <button class="action-btn danger" onclick="deleteProject('${project.id}', event)" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                            </div>
                            <div class="project-thumbnail">
                                ${project.thumbnail ? 
                                    `<img src="${project.thumbnail}" alt="${project.name}">` : 
                                    `<div class="project-thumbnail-placeholder">ğŸ“„</div>`
                                }
                            </div>
                            <div class="project-info">
                                <div class="project-title">${project.name || 'ì œëª© ì—†ëŠ” ë””ìì¸'}</div>
                                <div class="project-meta">
                                    <span>${dateStr}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Add click handlers
                document.querySelectorAll('.project-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        if (!e.target.closest('.project-actions')) {
                            const projectId = card.getAttribute('data-id');
                            window.location.href = `editor.html?id=${projectId}`;
                        }
                    });
                });
            } catch (error) {
                console.error('Error loading projects:', error);
                projectsGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-state-icon">âš ï¸</div>
                        <h3>í”„ë¡œì íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h3>
                        <p>${error.message}</p>
                        <button class="create-btn" onclick="loadProjects()">ë‹¤ì‹œ ì‹œë„</button>
                    </div>
                `;
            }
        }
        
        // Delete project from D1 database
        async function deleteProject(projectId, event) {
            event.stopPropagation();
            if (!confirm('ì´ ë””ìì¸ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/projects/${projectId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Reload projects
                    await loadProjects();
                } else {
                    alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                console.error('Error deleting project:', error);
                alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        // Load user info
        function loadUserInfo() {
            const user = JSON.parse(localStorage.getItem('vibe_user') || '{}');
            const userName = document.getElementById('userName');
            const userEmail = document.getElementById('userEmail');
            const userAvatar = document.getElementById('userAvatar');
            
            if (userName && user.name) {
                userName.value = user.name;
            }
            if (userEmail && user.email) {
                userEmail.value = user.email;
            }
            if (userAvatar && user.name) {
                userAvatar.textContent = user.name.charAt(0).toUpperCase();
            }
        }
        
        // Save profile
        const profileForm = document.getElementById('profileForm');
        if (profileForm) {
            profileForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const user = JSON.parse(localStorage.getItem('vibe_user') || '{}');
                const userName = document.getElementById('userName').value;
                
                user.name = userName;
                localStorage.setItem('vibe_user', JSON.stringify(user));
                
                if (userAvatar) {
                    userAvatar.textContent = userName.charAt(0).toUpperCase();
                }
                
                alert('í”„ë¡œí•„ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
            });
        }
        
        // Delete account
        const deleteAccountBtn = document.getElementById('deleteAccountBtn');
        if (deleteAccountBtn) {
            deleteAccountBtn.addEventListener('click', () => {
                if (confirm('ì •ë§ë¡œ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                    if (confirm('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤. ì •ë§ë¡œ ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        // Delete all projects
                        for (let i = localStorage.length - 1; i >= 0; i--) {
                            const key = localStorage.key(i);
                            if (key && (key.startsWith('vibe_project') || key.startsWith('vibe_user'))) {
                                localStorage.removeItem(key);
                            }
                        }
                        alert('ê³„ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        window.location.href = 'index.html';
                    }
                }
            });
        }
        
        // Dropdown item click handler
        document.querySelectorAll('.dropdown-item[data-tab]').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const targetTab = item.getAttribute('data-tab');
                const tabBtn = document.querySelector(`.tab-btn[data-tab="${targetTab}"]`);
                if (tabBtn) {
                    tabBtn.click();
                }
                userDropdown.classList.remove('show');
            });
        });
        
        // Logout
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    // Remove user session
                    sessionStorage.removeItem('vibe_user');
                    localStorage.removeItem('vibe_user');
                    // Redirect to login page
                    window.location.href = 'login.html';
                }
                userDropdown.classList.remove('show');
            });
        }
        
        // Initialize
        loadProjects();
        loadUserInfo();
    </script>
</body>
</html>

